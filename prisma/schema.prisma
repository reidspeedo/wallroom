// WallBoard Rooms - Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Single-tenant admin-level configuration
model UserSetting {
  id                    String   @id @default(uuid())
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")
  adminPasswordHash     String   @map("admin_password_hash")
  boardPublicToken      String   @unique @map("board_public_token")
  pollIntervalSeconds   Int      @default(10) @map("poll_interval_seconds")
  timeZone              String?  @map("time_zone")
  bookingDurations      Int[]    @default([15, 30, 60, 90, 120]) @map("booking_durations")
  extendIncrements      Int[]    @default([15, 30]) @map("extend_increments")

  @@map("user_settings")
}

// Bookable rooms
model Room {
  id           String    @id @default(uuid())
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  name         String    @db.VarChar(100)
  description  String?
  color        String?   @db.VarChar(20)
  isActive     Boolean   @default(true) @map("is_active")
  displayOrder Int       @default(0) @map("display_order")
  capacity     Int?
  bookings     Booking[]

  @@index([isActive, displayOrder])
  @@map("rooms")
}

// Room bookings
model Booking {
  id                      String    @id @default(uuid())
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")
  roomId                  String    @map("room_id")
  room                    Room      @relation(fields: [roomId], references: [id], onDelete: Cascade)
  title                   String    @db.VarChar(120)
  startTime               DateTime  @map("start_time")
  endTime                 DateTime  @map("end_time")
  endedEarlyAt            DateTime? @map("ended_early_at")
  extendedFromBookingId   String?   @map("extended_from_booking_id")
  source                  String    @default("board") @db.VarChar(20)
  status                  String    @default("active") @db.VarChar(20)

  @@index([roomId, startTime])
  @@index([roomId, status, startTime])
  @@map("bookings")
}

// Admin sessions
model Session {
  id           String   @id @default(uuid())
  createdAt    DateTime @default(now()) @map("created_at")
  expiresAt    DateTime @map("expires_at")
  sessionToken String   @unique @map("session_token")
  ipAddress    String?  @map("ip_address")
  userAgent    String?  @map("user_agent")
  admin        Boolean  @default(true)

  @@index([expiresAt])
  @@map("sessions")
}
